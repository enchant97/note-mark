/*
Source: https://github.com/enchant97/js-theme-changer
Commit Hash: d6d63705b2ca3873f34f2ac483df2586c8dcbf21
License: MIT - Copyright (c) 2021 Leo Spratt
*/
"use-strict"; class ThemeChanger { static saved_theme_key = "theme"; static theme_picker_id = "theme-picker-selector"; static theme_picker_parent = null; static selected_theme_css_class = "current"; static theme_keys = { OS: "os", LIGHT: "light", DARK: "dark" }; static theme_meta = { "os": ["OS", []], "light": ["Light", []], "dark": ["Dark", []] }; static curr_theme = ThemeChanger.theme_keys.OS; static get_stored_theme_choice() { var new_theme = window.localStorage.getItem(ThemeChanger.saved_theme_key); if (new_theme === null) { new_theme = window.sessionStorage.getItem(ThemeChanger.saved_theme_key) } if (new_theme === null) { new_theme = ThemeChanger.theme_keys.OS } ThemeChanger.curr_theme = new_theme; return new_theme } static load_theme_properties() { const theme_properties = ThemeChanger.theme_meta[ThemeChanger.curr_theme][1]; theme_properties.forEach(key_value => { document.documentElement.style.setProperty(key_value[0], key_value[1]) }) } static change_theme(theme_key, use_local = false, allow_reload = true) { if (use_local) { window.localStorage.setItem(ThemeChanger.saved_theme_key, theme_key); window.sessionStorage.removeItem(ThemeChanger.saved_theme_key) } else { window.sessionStorage.setItem(ThemeChanger.saved_theme_key, theme_key); window.localStorage.removeItem(ThemeChanger.saved_theme_key) } ThemeChanger.get_stored_theme_choice(); if (theme_key === ThemeChanger.theme_keys.OS && allow_reload) { window.location.reload(); return } ThemeChanger.load_theme_properties(); ThemeChanger.remove_theme_picker() } static on_load() { ThemeChanger.get_stored_theme_choice(); ThemeChanger.load_theme_properties() } static create_theme_picker_button(theme_key, use_local, allow_reload) { const bnt_text = ThemeChanger.theme_meta[theme_key][0]; const element = document.createElement('button'); element.addEventListener('click', _event => { ThemeChanger.change_theme(theme_key, use_local, allow_reload) }); element.innerText = bnt_text; if (ThemeChanger.curr_theme === theme_key) { element.classList.add(ThemeChanger.selected_theme_css_class) } return element } static insert_theme_picker(use_local, allow_reload) { const picker_element = document.createElement("div"); picker_element.setAttribute("id", ThemeChanger.theme_picker_id); for (let key in ThemeChanger.theme_keys) { picker_element.appendChild(ThemeChanger.create_theme_picker_button(ThemeChanger.theme_keys[key], use_local, allow_reload)) } if (ThemeChanger.theme_picker_parent === null) { ThemeChanger.theme_picker_parent = document.body } ThemeChanger.theme_picker_parent.insertAdjacentElement("afterbegin", picker_element) } static remove_theme_picker() { const picker_element = document.getElementById(ThemeChanger.theme_picker_id); picker_element?.remove() } static toggle_theme_picker(use_local = false, allow_reload = true) { const picker_element = document.getElementById(ThemeChanger.theme_picker_id); if (picker_element === null) { ThemeChanger.insert_theme_picker(use_local, allow_reload) } else { ThemeChanger.remove_theme_picker() } } }
